/*! jquery-indexeddb  v1.0.0 2013-08-03 */
(function(e){"use strict";function n(e){var n=null;switch(e){case 0:case 1:case"readwrite":case"readonly":n=e;break;default:n=u.READ_WRITE||"readwrite"}return n}var t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,r=window.IDBKeyRange||window.webkitIDBKeyRange,o=window.IDBCursor||window.webkitIDBCursor||{};o.PREV=o.PREV||"prev",o.NEXT=o.NEXT||"next";var u=window.IDBTransaction||window.webkitIDBTransaction;e.extend({indexedDB:function(o,u){if(u){"number"==typeof u&&(u={version:u});var i=u.version;if(u.schema&&!i){var c=-1;for(var a in u.schema)c=c>a?c:a;i=u.version||c}}var f={request:function(n,t){return e.Deferred(function(e){try{var r="function"==typeof n?n(t):n;r.onsuccess=function(n){e.resolveWith(r,[r.result,n])},r.onerror=function(n){e.rejectWith(r,[r.error,n])},r.onblocked!==undefined&&null===r.onblocked&&(r.onblocked=function(n){var t;try{t=r.result}catch(n){t=null}e.notifyWith(r,[t,n])}),r.onupgradeneeded!==undefined&&null===r.onupgradeneeded&&(r.onupgradeneeded=function(n){e.notifyWith(r,[r.result,n])})}catch(o){o.name="exception",e.rejectWith(r,["exception",o])}})},transaction:function(e){return{objectStore:function(n){try{return f.objectStore(e.objectStore(n))}catch(t){return e.readyState!==e.DONE&&e.abort(),f.objectStore(null)}},createObjectStore:function(n,t){try{return f.objectStore(e.db.createObjectStore(n,t))}catch(r){e.readyState!==e.DONE&&e.abort()}},deleteObjectStore:function(n){try{e.db.deleteObjectStore(n)}catch(t){e.readyState!==e.DONE&&e.abort()}},abort:function(){e.abort()}}},objectStore:function(e){for(var n={},t=["add","put","get","delete","clear","count"],r=0;t.length>r;r++)n[t[r]]=function(n){return function(){return f.request(function(t){return e[n].apply(e,t)},arguments)}}(t[r]);return n.each=function(n,t,r){return f.cursor(function(){return r?e.openCursor(f.range(t),r):e.openCursor(f.range(t))},n)},n.index=function(n){return f.index(function(){return e.index(n)})},n.createIndex=function(n,t,r){return 2===arguments.length&&"string"==typeof t&&(r=arguments[1],t=null),r||(r=n),f.index(function(){return e.createIndex(r,n,t)})},n.deleteIndex=function(n){return e.deleteIndex(n)},n},range:function(n){return e.isArray(n)?1===n.length?r.only(n[0]):r.bound(n[0],n[1],n[2]===undefined?!1:n[2],n[3]===undefined?!1:n[3]):n===undefined?null:n},cursor:function(n,t){return e.Deferred(function(e){try{var r="function"==typeof n?n():n;r.onsuccess=function(n){if(!r.result)return e.resolveWith(r,[null,n]),undefined;var o={"delete":function(){return f.request(function(){return r.result["delete"]()})},update:function(e){return f.request(function(){return r.result.update(e)})},next:function(e){this.data=e},key:r.result.key,value:r.result.value};e.notifyWith(r,[o,n]);var u=t.apply(r,[o]);try{u===!1?e.resolveWith(r,[null,n]):"number"==typeof u?r.result.advance.apply(r.result,[u]):o.data?r.result["continue"].apply(r.result,[o.data]):r.result["continue"]()}catch(n){e.rejectWith(r,[r.result,n])}},r.onerror=function(n){e.rejectWith(r,[r.result,n])}}catch(o){o.type="exception",e.rejectWith(r,[null,o])}})},index:function(e){try{var n="function"==typeof e?e():e}catch(t){n=null}return{each:function(e,t,r){return f.cursor(function(){return r?n.openCursor(f.range(t),r):n.openCursor(f.range(t))},e)},eachKey:function(e,t,r){return f.cursor(function(){return r?n.openKeyCursor(f.range(t),r):n.openKeyCursor(f.range(t))},e)},get:function(e){return"function"==typeof n.get?f.request(n.get(e)):n.openCursor(f.range(e))},count:function(){if("function"==typeof n.count)return f.request(n.count());throw"Count not implemented for cursors"},getKey:function(e){return"function"==typeof n.getKey?f.request(n.getKey(e)):n.openKeyCursor(f.range(e))}}}},s=f.request(function(){return i?t.open(o,parseInt(i)):t.open(o)});return s.then(function(e){e.onversionchange=function(){u&&u.onversionchange&&u.onversionchange()!==!1||e.close()}},function(){},function(e,n){if(n&&"upgradeneeded"===n.type){if(u&&u.schema)for(var t=n.oldVersion+1;n.newVersion>=t;t++)"function"==typeof u.schema[t]&&u.schema[t].call(this,f.transaction(this.transaction));u&&"function"==typeof u.upgrade&&u.upgrade.call(this,f.transaction(this.transaction))}}),e.extend(s,{cmp:function(e,n){return t.cmp(e,n)},deleteDatabase:function(){return e.Deferred(function(e){s.then(function(n){n.close(),f.request(function(){return t.deleteDatabase(o)}).then(function(n,t){e.resolveWith(this,[n,t])},function(n,t){e.rejectWith(this,[n,t])},function(n,t){e.notifyWith(this,[n,t])})},function(n,t){e.rejectWith(this,[n,t])},function(n,t){e.notifyWith(this,[n,t])})})},transaction:function(t,r){return!e.isArray(t)&&(t=[t]),r=n(r),e.Deferred(function(e){s.then(function(n,o){var u;try{u=n.transaction(t,r),u.onabort=u.onerror=function(n){e.rejectWith(u,[n])},u.oncomplete=function(n){e.resolveWith(u,[n])}}catch(o){return o.type="exception",e.rejectWith(this,[o]),undefined}try{e.notifyWith(u,[f.transaction(u)])}catch(o){o.type="exception",e.rejectWith(this,[o])}},function(n,t){e.rejectWith(this,[t,n])},function(){})})},objectStore:function(r,i){function c(c){return e.Deferred(function(e){function a(n,t){try{t(n.objectStore(r)).then(function(n,t){e.resolveWith(this,[n,t])},function(n,t){e.rejectWith(this,[n,t])})}catch(o){o.name="exception",e.rejectWith(n,[o,o])}}h.transaction(r,n(i)).then(function(){},function(d,l){if(d.code!==d.NOT_FOUND_ERR||i!==!0&&"object"!=typeof i)e.rejectWith(this,[d,l]);else{var p=this.result;p.close(),s=f.request(function(){return t.open(o,(parseInt(p.version,10)||1)+1)}),s.then(function(t){t.onversionchange=function(){u&&u.onversionchange&&u.onversionchange()!==!1||t.close()},h.transaction(r,n(i)).then(function(){},function(n,t){e.rejectWith(this,[n,t])},function(e){a(e,c)})},function(n,t){e.rejectWith(this,[n,t])},function(n,t){if("upgradeneeded"===t.type)try{n.createObjectStore(r,i===!0?{autoIncrement:!0}:i)}catch(o){e.rejectWith(this,[o,t])}})}},function(e){a(e,c)})})}function a(e,n){return c(function(t){return t[e].apply(t,n)})}function d(e,n,t){return c(function(r){var o=r.index(n);return o[e].apply(o[e],t)})}for(var h=this,l={},p=["add","delete","get","put","clear","count","each"],y=0;p.length>y;y++)l[p[y]]=function(e){return function(){return a(e,arguments)}}(p[y]);return l.index=function(e){return{each:function(n,t,r){return d("each",e,[n,t,r])},eachKey:function(n,t,r){return d("eachKey",e,[n,t,r])},get:function(n){return d("get",e,[n])},count:function(){return d("count",e,[])},getKey:function(n){return d("getKey",e,[n])}}},l}})}}),e.indexedDB.IDBCursor=o,e.indexedDB.IDBTransaction=u,e.idb=e.indexedDB})(jQuery);
